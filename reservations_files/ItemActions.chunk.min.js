(("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper=("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper||[]).push([[1],{366:function(e,t,o){e.exports={default:o(367),__esModule:!0}},367:function(e,t,o){var i=o(18),s=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}},806:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.itemActions=void 0;var i=g(o(42)),s=g(o(366)),a=g(o(37)),l=g(o(47)),r=g(o(12)),n=g(o(13)),c=g(o(6)),h=o(83),u=g(o(51)),d=g(o(94)),p=g(o(4)),f=o(27);function g(e){return e&&e.__esModule?e:{default:e}}var v=function(){function e(){(0,r.default)(this,e),this.getLoveCount=this.getLoveCount.bind(this),this.wasInit=!1,this.loveCounts={},this.fetchSiteInfo()}return(0,n.default)(e,[{key:"initWidgetData",value:function(e){if(this.config=e,e.compId&&(this.compId=e.compId),e.pageId&&(this.pageId=e.pageId),e.styleId&&(this.styleId=e.styleId),e.pageUrl&&(this.pageUrl=e.pageUrl),"boolean"==typeof e.isStoreGallery&&(this.isStoreGallery=e.isStoreGallery),e.galleryId&&(this.galleryId=e.galleryId),e.viewMode&&(this.viewMode=e.viewMode),e.fullscreenUrl){this.siteUrl=this.fullscreenUrl=this.normalizeFullscreenUrl(e.fullscreenUrl);try{this.siteUrl=this.fullscreenUrl.match(/.*\..*\//g)[0]}catch(e){}}return e.onLoveCountsFetched&&(this.onLoveCountsFetched=e.onLoveCountsFetched),this.baseUrl=e.baseUrl||"//progallery.wix.com",e.reachLevel&&this.setReachLevel(e.reachLevel),!h.baseUtils.isSSR()&&"site"===this.viewMode.toLowerCase()&&this.galleryId&&""!==this.galleryId&&this.getStats(),this.wasInit=e,Date.now()}},{key:"normalizeFullscreenUrl",value:function(e){var t=e;return e&&(t=e.split("?")[0]),t}},{key:"fetchSiteInfo",value:function(){var e=this,t=void 0;try{t=p.default.location.href}catch(e){t=""}h.baseUtils.isInWix()?(this.siteInfo={},u.default.getSiteInfo((function(t){e.siteInfo=t}))):this.siteInfo={url:t,baseUrl:t,siteTitle:"Wix Pro Gallery",siteDescription:"The best gallery any Wix user has ever seen!",siteKeywords:"gallery,photos,photographer,professional"}}},{key:"getSiteUrl",value:function(){return this.siteInfo.url}},{key:"getStats",value:function(){var e=this;if("site"===this.viewMode.toLowerCase()&&!h.baseUtils.isDev()&&!h.baseUtils.isTest()){if(!this.galleryId||""===this.galleryId||this.galleryId.length<10)return console.log("galleryId id",this.galleryId,(0,l.default)(this.galleryId)),void console.error("get stats error - no galleryId");fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/stats/properties").then((function(e){return e.json()})).then((function(t){try{t.properties?e.statsProps=JSON.parse(t.properties):t.statsToken&&(e.statsProps={instance_id:e.config.instanceId,set_id:e.galleryId}),e.statsToken=t.statsToken}catch(e){console.error("Failed getting stats props",e)}}));var t=void 0;try{t=this.config.instanceId||p.default.instanceId}catch(e){t=""}t?fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/"+t+"/stats").then((function(e){return e.json()})).then((function(t){try{t&&t.photoId2Love&&(e.loveCounts=t.photoId2Love,e.onLoveCountsFetched&&e.onLoveCountsFetched(e.loveCounts))}catch(e){console.error("Failed getting love counts",e)}})):console.warn("cannot report love counter - no instance id")}}},{key:"getLoveCount",value:function(e){return Math.max(0,this.loveCounts[e])||0}},{key:"html2img",value:function(e,t){new a.default((function(e){o.e(11).then(function(t){e(o(803))}.bind(null,o)).catch(o.oe)})).then((function(o){try{var i=p.default.document.createElement("div");i.innerHTML=e.html,i.style.boxSizing="border-box",i.style.background=e.style.bgColor,i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.zIndex=-1,i.className="text-item",p.default.document.body.appendChild(i),o(i).then((function(e){i.remove();var o=e.toDataURL();"function"==typeof t&&t(o)}))}catch(e){"function"==typeof t&&t("")}}))}},{key:"share",value:function(e,t,o){h.baseUtils.isDemo()||(o&&(t.numOfItems=o),this.shareImp(e,t))}},{key:"downloadTextItem",value:function(e){this.html2img(e,(function(e){try{e=e.replace(/^data:image\/[^;]/,"data:application/octet-stream"),p.default.open(e)}catch(e){}}))}},{key:"getReachLevel",value:function(e){var t=Number(e||0),o=void 0;if(c.default.isUndefined(this.reachLevel)){var i=h.baseUtils.getLocalStorage();o=Number(i[this.siteUrl+"|reach-level"]||0)+t}else o=this.reachLevel+t;return o}},{key:"setReachLevel",value:function(e){e>0||(e=0);try{var t=this.getReachLevel(0);if(e>0&&0===t&&c.default.isUndefined(this.reachLevel))h.baseUtils.getLocalStorage()[this.siteUrl+"|reach-level"]=e,this.reachLevel=e}catch(e){console.warn("set reach level error",e)}}},{key:"getShareUrl",value:function(e){return!f.experimentsWrapper.getExperimentBoolean("specs.pro-gallery.newFullscreenShare")||h.baseUtils.isStoreGallery()||this.isStoreGallery?this.fullscreenUrl+"/"+this.compId+"/"+this.getItemId(e)+"/"+e.idx+"/"+encodeURIComponent("?i="+e.idx+"&p="+this.pageId+"&s="+this.styleId+"&rl="+this.getReachLevel(1)+(e.hashtag?"&ht="+e.hashtag:"")):this.pageUrl+"?pgid="+this.compId.replace("comp-","")+"-"+this.getItemId(e)}},{key:"getItemId",value:function(e){return e.id||e.photoId||e.itemId}},{key:"shareImp",value:function(e,t,o){var i={id:this.getItemId(t),idx:t.idx||0,url:t.createUrl&&t.createUrl("sample","img"),title:t.title||t.description||this.siteInfo.siteTitle,hashtag:t.hashtag},s=encodeURIComponent(this.getShareUrl(i)),a=encodeURIComponent(i.title||""),l=encodeURIComponent(i.url),r=encodeURIComponent(this.siteInfo.siteKeywords),n=encodeURIComponent(""+this.getShareUrl(i));switch(c.default.isFunction(o)||(o=function(e,t){try{if(h.baseUtils.isiOS()&&"Email"===t)p.default.location.href=e;else{var o=p.default.open(e,t+" Share","height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");setTimeout((function(){try{"Email"===t&&o.location.hasOwnProperty("pathname")&&"blank"===o.location.pathname&&o.close()}catch(e){console.warn("Could not close mailto window")}}),5e3)}}catch(e){}}),e){case"facebook":o("http://www.facebook.com/sharer/sharer.php?u="+s+"&t="+a,"Facebook");break;case"twitter":var u="&amp;text="+("undefined"===a?"":a);if(u.length>110)u=u.slice(0,107)+"...";else{var d="&amp;hashtags="+r;(u+d).length<=110&&(u+=d)}o("https://twitter.com/intent/tweet?url="+s+u,"Twitter");break;case"pinterest":o("https://pinterest.com/pin/create/button/?url="+s+"&media="+l.replace("webp","jpg")+"&description="+a,"Pinterest");break;case"google":o("https://plus.google.com/share?url="+s,"Google Plus");break;case"tumblr":o("http://www.tumblr.com/share/link?url="+s,"Tumblr");break;case"email":o("mailto:?Subject="+a+"&body="+n,"Email")}}},{key:"reportLoveToStats",value:function(e,t){try{if(!this.statsProps||!this.statsProps.instance_id)return void this.getStats();var o=c.default.merge(this.statsProps,{photo_id:e}),i=this.statsToken||p.default.statsToken,a=h.baseUtils.generateUUID();fetch(p.default.location.protocol+"//photographers-counters.wix.com/collector/rest/collect-js?ctToken="+i,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,s.default)({messageId:a,metrics:[{type:"photo",reportMetrics:[{name:"love",value:String(t)}],properties:o}]})}).then((function(e){console.log("Success report love",e)}))}catch(e){console.error("Error reporting love to stats",e)}}},{key:"getLoveStorageKey",value:function(e){return"pro-gallery-item-love-"+e}},{key:"isLoved",value:function(e){try{return void 0!==h.baseUtils.getLocalStorage()&&(!!h.baseUtils.getLocalStorage()[this.getLoveStorageKey(e)]||!1)}catch(e){console.warn("isLoved failed",e)}}},{key:"toggleLove",value:function(e,t){try{if(!h.baseUtils.getLocalStorage())return!1;var o=void 0;this.isLoved(e)&&!0!==t||!1===t?(h.baseUtils.getLocalStorage()[this.getLoveStorageKey(e)]="",o=-1):(h.baseUtils.getLocalStorage()[this.getLoveStorageKey(e)]=!0,o=1),this.reportLoveToStats(e,o)}catch(e){console.warn("toggleLove failed",e)}}},{key:"isFirstLoveClick",value:function(e){try{return void 0===h.baseUtils.getLocalStorage()[this.getLoveStorageKey(e)]}catch(e){console.warn("isFirstLoveClick failed",e)}}},{key:"postLoveActivity",value:function(e){var t=this.getItemId(e);this.isFirstLoveClick(t)&&function(e){try{var t={type:u.default.Activities.Type.SOCIAL_TRACK,info:{type:e.activityType,channel:e.activityNetwork,itemInfo:{itemUrl:e.url,itemId:e.id,itemType:e.type.toUpperCase()}},details:{additionalInfoUrl:e.url,summary:""},contactUpdate:null};u.default.Activities.postActivity(t,(function(e){console.log("Activity ID: "+e.activityId+", Contact ID: "+e.contactId)}),(function(e){console.log("Failure message:",e)}))}catch(e){console.log("error posting activity.",e)}}({activityType:"LOVE",activityNetwork:"SITE",id:t,url:this.getShareUrl(e),type:e.type})}},{key:"showTooltip",value:function(e,t,o){if(!(document.getElementsByClassName("pro-tooltip").length>=1)){var s=e.currentTarget;if(s){var a=s.getBoundingClientRect(),l=a.top,r=a.left,n=void 0,c=void 0;try{c=p.default.innerWidth}catch(e){c=980}switch(void 0===o&&(o=r>c/2?"right":"left"),o){case"top":n={top:l-30+"px",left:r+28+"px",opacity:1};break;case"right":n={top:l-4+"px",left:r-20+"px",opacity:1};break;default:case"left":n={top:l-4+"px",left:r+40+"px",opacity:1}}n["pointer-events"]="none";var h=p.default.document.createElement("div");h.classList.add("pro-tooltip"),h.classList.add(o),(0,i.default)(h.style,n),h.innerHTML=d.default.getByKey(t),p.default.document.body.appendChild(h)}}}},{key:"hideTooltip",value:function(){p.default.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])}},{key:"toggleTooltip",value:function(e,t,o){1===document.getElementsByClassName("pro-tooltip").length?this.hideTooltip():this.showTooltip(e,t,o)}},{key:"viewClassName",value:function(e,t){return"fullscreen"===e&&"desktop"===t?"fullscreen-icon":""}}]),e}();t.default=v;t.itemActions=new v}}]);
//# sourceMappingURL=ItemActions.chunk.min.js.map